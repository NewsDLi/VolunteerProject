<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<html lang="zh-cmn-Hans" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,user-scalable=0,viewport-fit=cover">
<title>WeUI</title>
<link rel="stylesheet" href="css/weui.css" />
<link rel="stylesheet" href="css/example.css" />
</head>
<script type="text/javascript"
	src="https://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="https://res.wx.qq.com/open/libs/weuijs/1.0.0/weui.min.js"></script>
<script src="js/jquery.js"></script>
<script src="js/toast.js"></script>
<script type="text/javascript">
	$(function() {
		init();
		$('.weui-btn_primary').click(function() {
			var content = $(".weui-textarea").val();
			if (content.trim().length == 0) {
				return false;
			}
			$.ajax({
				type : "POST",
				url : "/messageBoard/content",
				data : "content=" + content,
				success : function(data) {
					if (data.message == 'success') {
						Toast("操作成功",2000);
						$('.weui-textarea').val('');
						showMessage(data);
					}
				}
			});
		})
		$('.weui-textarea').bind('input propertychange',function() {
			if ($(".weui-textarea").val().length >= 200) {
				$(".weui-textarea").val(
						$(".weui-textarea").val().substring(0,
								200))
			}
			if ($(".weui-textarea").val().length != "") {
				$('.fountCount').html(
						$(".weui-textarea").val().length);
			}
		});
	})
	function init() {
		$.ajax({
			type : "get",
			url : "/getAllMessageBoard",
			success : function(data) {
				if (data.message == 'success') {
					showMessage(data);
				}
			}
		});
	}
	function showMessage(data) {
		$('.show_message_board').removeClass('none');
		var content = '';
		for (var i = 0; i < data.data.length; i++) {
			content += '<p><span>' + data.data[i].userName + '</span>：<span>'
					+ data.data[i].content + '</span></p>';
		}
		$('.show_message_board').html(content);
		$(".container").css("height", $('.page__hd').height()+ $('.button-sp-area').height() + $('.show_message_board').height()+200)
	}
</script>
<body ontouchstart>
	<div class="container" id="container">
		<div class="page button js_show">
			<div class="page__hd">
				<h1 class="page__title">留言板</h1>
			</div>
			<div class="button-sp-area">
				<a href="javascript:;"
					class="weui-btn weui-btn_mini weui-btn_primary">发表</a>
				<div class="weui-cells weui-cells_form">
					<div class="weui-cell" style="height: 400px;">
						<div class="weui-cell__bd" style="height: 100%">
							<textarea class="weui-textarea" style="height: 90%"
								placeholder="请输入留言" rows="3"></textarea>
							<div class="weui-textarea-counter">
								<span class="fountCount">0</span>/200
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="none show_message_board button-sp-area"></div>
		</div>
		<div th:include="tabbar::pagination"></div>
	</div>
</body>
</html>
